<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gathr 爱情需求卡（测试版）</title>
  <style>
    :root { --bd:#ddd; --text:#111; --muted:#666; --bg:#fff; --soft:#f6f6f6; }
    body { font-family: system-ui, -apple-system, "PingFang SC", "Noto Sans SC", sans-serif; max-width: 860px; margin: 24px auto; padding: 0 16px; color:var(--text); background:var(--bg); line-height: 1.5; }
    h1 { font-size: 22px; margin: 0 0 6px; }
    .muted { color: var(--muted); font-size: 14px; margin-bottom: 14px; }
    .shell { border:1px solid var(--bd); border-radius: 14px; padding: 14px; }
    .topbar { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom: 10px; }
    .step { font-size: 13px; color: var(--muted); }
    .progressWrap { flex:1; display:flex; align-items:center; gap:10px; }
    .progressOuter { height: 10px; background: var(--soft); border-radius: 999px; overflow:hidden; width:100%; border:1px solid var(--bd); }
    .progressInner { height: 100%; width:0%; background:#111; }
    .qcard { border:1px solid var(--bd); border-radius: 14px; padding: 16px; }
    .qtitle { font-weight: 800; margin-bottom: 10px; font-size: 16px; }
    .qhint { color: var(--muted); font-size: 13px; margin-top: -6px; margin-bottom: 10px; }
    .opts { display:grid; gap: 10px; }
    label.opt { display:flex; gap:10px; align-items:flex-start; cursor:pointer; padding:10px; border:1px solid var(--bd); border-radius: 12px; }
    label.opt:hover { background:#fafafa; }
    input[type="radio"] { margin-top: 3px; }
    select, textarea { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid #ccc; font-size: 14px; }
    textarea { min-height: 110px; resize: vertical; }
    .nav { display:flex; justify-content:space-between; gap:10px; margin-top: 12px; }
    button { padding: 10px 14px; border-radius: 12px; border: 1px solid #222; background: #222; color: #fff; cursor: pointer; }
    button.secondary { background:#fff; color:#222; }
    button:disabled { opacity:0.4; cursor:not-allowed; }
    .mini { font-size: 12px; color: var(--muted); margin-top: 8px; }
    .warn { color: #a00; font-weight: 700; margin-top: 10px; }
    .result { border:2px solid #222; border-radius: 14px; padding: 16px; margin-top: 14px; }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; border: 1px solid #222; margin-right: 8px; font-size: 13px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 13px; background: #f6f6f6; padding: 10px; border-radius: 10px; overflow:auto; }
    .footerActions { display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
  </style>
</head>

<body>
  <h1>Gathr 爱情需求卡（测试版）</h1>
  <div class="muted">一题一页 · 进度条 · 上一题 / 下一题 · 最后自动输出「主类型 + 次类型（若有）」</div>

  <div class="shell">
    <div class="topbar">
      <div class="step" id="stepText">第 1 / 21 题</div>
      <div class="progressWrap">
        <div class="progressOuter" aria-label="progress">
          <div class="progressInner" id="progressInner"></div>
        </div>
      </div>
    </div>

    <div id="questionArea"></div>

    <div class="nav">
      <button class="secondary" id="btnPrev">上一题</button>
      <button id="btnNext">下一题</button>
    </div>

    <div class="mini" id="miniHint"></div>
    <div class="warn" id="warn"></div>

    <div id="out"></div>

    <div class="footerActions">
      <button class="secondary" id="btnReset">清空重来</button>
      <button class="secondary" id="btnJumpToResult" title="仅用于内测：跳到最后一题">跳到最后</button>
    </div>
  </div>

<script>
/**
 * =========================
 * 1) 题库（v1.1）
 * =========================
 * 类型：
 * - scale: 1~5
 * - single: 单选（radio）
 * - bool: 是/否（radio）
 * - text: 开放题（可选）
 */
const QUESTIONS = [
  // 第一段（4）
  { id:"Q1", type:"scale", title:"Q1 目前在你的人生中，「感情」的重要程度是？", labels:["1 不重要","2","3","4","5 非常重要"] },
  { id:"Q2", type:"single", title:"Q2 如果一段关系需要你稳定投入时间与心力，你的第一反应是？",
    options:[["A","现在不太行"],["B","可以，但会有压力"],["C","没问题，我有余裕"]] },
  { id:"Q3", type:"single", title:"Q3 如果短期内没有发展出关系，你会？",
    options:[["A","松一口气"],["B","有点可惜，但能接受"],["C","会明显失落"]] },
  { id:"Q4", type:"bool", title:"Q4 你是否认同：『我现在的人生重心，可能暂时放不下一段需要被认真对待的关系。』" },

  // 第二段（6）
  { id:"Q5", type:"single", title:"Q5（强制单选）如果只能选一个，你现在最希望关系带来的是？",
    options:[["A","生活中不要那么孤单（一起吃饭、玩、出门）"],["B","被在乎、被回应、被放在心上"],["C","有人可以一起把生活过好"],["D","我现在说不清楚"]] },
  { id:"Q6", type:"scale", title:"Q6 你对「周末是否有人一起安排活动」的在意程度？", labels:["1 完全不在意","2","3","4","5 非常在意"] },
  { id:"Q7", type:"scale", title:"Q7 你对「情绪是否被稳定回应」的在意程度？", labels:["1 不需要","2","3","4","5 非常需要"] },
  { id:"Q8", type:"scale", title:"Q8 你对「一起规划生活（居住、作息、未来）」的在意程度？", labels:["1 完全没想过","2","3","4","5 非常在意"] },
  { id:"Q9", type:"single", title:"Q9（二选一）如果只能选一个，你更在意？",
    options:[["A","关系能不能自然融入生活"],["B","情绪有没有被稳定接住"]] },
  { id:"Q10", type:"single", title:"Q10 当你情绪低落时，你更希望对方？",
    options:[["A","陪我做点事、转移注意力"],["B","听我说、理解我的感受"],["C","用实际行动支持我"]] },

  // 第三段（6）
  { id:"Q11", type:"single", title:"Q11 如果关系需要你调整生活习惯（作息、时间），你会？",
    options:[["A","尽量不调整"],["B","可以微调"],["C","愿意认真协调"]] },
  { id:"Q12", type:"scale", title:"Q12 你是否愿意为了关系，减少部分个人自由时间？", labels:["1 完全不愿意","2","3","4","5 非常愿意"] },
  { id:"Q13", type:"single", title:"Q13 关于「住在一起」这件事，你目前的感觉？",
    options:[["A","完全不在考虑范围"],["B","未来可能，但不是现在"],["C","是我会认真思考的事"]] },
  { id:"Q14", type:"single", title:"Q14 你是否认同：『只要有情感连结，不一定要常见面或一起生活。』",
    options:[["H","非常认同"],["M","有点认同"],["L","不太认同"]] },
  { id:"Q15", type:"single", title:"Q15 你是否认同：『如果关系稳定，我会希望它自然走进我的日常生活。』",
    options:[["H","非常认同"],["M","有点认同"],["L","不太认同"]] },
  { id:"Q16", type:"single", title:"Q16 当关系遇到现实压力（时间、距离、家庭），你通常会？",
    options:[["A","优先保护自己的生活"],["B","尝试协调看看"],["C","会把关系纳入重要考量"]] },

  // 第四段（5）
  { id:"Q17", type:"single", title:"Q17 你目前的状态更接近？",
    options:[["A","稳定但忙碌"],["B","正在经历转折或调整期"],["C","状态稳定，想认真投入关系"]] },
  { id:"Q18", type:"bool", title:"Q18 你是否认同：『我现在更想认识人，而不是立刻确定关系。』" },
  { id:"Q19", type:"scale", title:"Q19 你目前对「长期关系」的心理准备度？", labels:["1 几乎没有","2","3","4","5 很高"] },
  { id:"Q20", type:"scale", title:"Q20 你对关系「不确定性」的容忍度？", labels:["1 非常低","2","3","4","5 非常高"] },
  { id:"Q21", type:"text",  title:"Q21（可选）你希望现在的关系，为你的人生带来什么？", optional:true }
];

/**
 * =========================
 * 2) 类型文案（最终输出）
 * =========================
 */
const COPY = {
  T1: {
    title: "T1｜关系暂缓型：现在的人生，真的已经很满了",
    one: "你不是不重视感情，而是你现在的人生，暂时装不下一段需要被认真对待的关系。",
    body: "你目前的能量与生活重心，更多放在其他重要的事情上。这并不代表你不适合恋爱，而是你很清楚自己的边界，也不想勉强开始一段无法好好经营的关系。",
    tip: "现在不进入关系，本身也是一种对自己和他人的负责。等人生空间松动时，你会更清楚自己要什么。"
  },
  T2: {
    title: "T2｜低密度连结型：想要有人一起，但不想被关系占满",
    one: "你希望关系自然地发生在生活里，而不是成为压力来源。",
    body: "你在意的是陪伴感与生活体验：一起吃饭、出门、旅行，让生活不那么孤单。你并不排斥情感，但不希望关系要求你过度调整现有的人生节奏。",
    tip: "对你来说，好的关系应该是加分，而不是负担。找到节奏相近的人，比谈得很深更重要。"
  },
  T3: {
    title: "T3｜情感补位型：我想被在乎、被回应",
    one: "你真正重视的，是情绪有没有被认真对待。",
    body: "你希望在关系中感受到稳定的情感连结。不一定要天天见面，但你很在意对方是否愿意理解你、回应你、把你放在心上。",
    tip: "你需要的是情感上的可靠，而不是形式上的热闹。当对方能接住你时，你会非常投入。"
  },
  T4: {
    title: "T4｜生活伙伴型：我想要的是，一起把日子过好",
    one: "你期待关系能真正走进生活，而不是只停在感觉。",
    body: "你开始在意现实层面的协作：生活安排、时间分配、未来规划。情感不一定要浓烈，但关系要稳定、好沟通、能一起面对现实。",
    tip: "对你来说，适不适合往往比爱不爱更重要。你适合能和你并肩生活的人。"
  },
  T5: {
    title: "T5｜认真投入型：我已准备好，把关系放进人生规划",
    one: "你愿意为了合适的关系，调整自己的人生。",
    body: "你对亲密关系有明确期待，也有足够的心理准备。你希望关系是长期的，并且能成为人生的重要组成部分。",
    tip: "你适合同样认真、清楚自己要什么的人。慢一点没关系，但方向要一致。"
  },
  T6: {
    title: "T6｜探索过渡型：我正在重新认识自己",
    one: "你现在更重要的，不是定义关系，而是确认自己。",
    body: "你正处在人生或情感的转折阶段。你愿意认识人、交流、尝试，但还不急着给关系下定义。",
    tip: "探索不是逃避，而是一种对未来更负责的准备。当你准备好时，你会更笃定。"
  }
};

/**
 * =========================
 * 3) 计分规则（v2.0）
 * =========================
 * 指标：
 * - I_Energy: 1~5 avg
 * - I_Companion/I_Emotion/I_Life: 0~20 sum (Q5权重 0.8 若选D)
 * - I_Commit: 1~5 avg
 */

function mapABCTo135(v){ return v==="A"?1 : v==="B"?3 : 5; }
function mapBoolTo15(v){ return v===true?1 : 5; } // Q4: 是=1, 否=5
function mapHMLTo531(v){ return v==="H"?5 : v==="M"?3 : 1; }

function calcIndexes(ans){
  // Required checks（除Q21外都必须）
  for (const q of QUESTIONS){
    if (q.id === "Q21") continue; // optional
    if (ans[q.id] === undefined || ans[q.id] === null || ans[q.id] === "") {
      throw new Error(`尚未完成：${q.id}`);
    }
  }

  // I_Energy
  const q1 = +ans.Q1;
  const q2v = mapABCTo135(ans.Q2);
  const q3v = mapABCTo135(ans.Q3);
  const q4v = mapBoolTo15(ans.Q4);
  const I_Energy = (q1 + q2v + q3v + q4v) / 4;

  // weight
  const w = (ans.Q5 === "D") ? 0.8 : 1.0;

  // function scores
  const I_Companion_raw =
    (ans.Q5 === "A" ? 5 : 0) +
    (+ans.Q6) +
    (ans.Q9 === "A" ? 5 : 0) +
    (ans.Q10 === "A" ? 5 : 0);

  const I_Emotion_raw =
    (ans.Q5 === "B" ? 5 : 0) +
    (+ans.Q7) +
    (ans.Q9 === "B" ? 5 : 0) +
    (ans.Q10 === "B" ? 5 : 0);

  const I_Life_raw =
    (ans.Q5 === "C" ? 5 : 0) +
    (+ans.Q8) +
    (ans.Q10 === "C" ? 5 : 0) +
    mapHMLTo531(ans.Q15);

  const I_Companion = I_Companion_raw * w;
  const I_Emotion   = I_Emotion_raw   * w;
  const I_Life      = I_Life_raw      * w;

  // I_Commit
  const q11v = mapABCTo135(ans.Q11);
  const q12 = +ans.Q12;
  const q13v = mapABCTo135(ans.Q13);
  const q16v = mapABCTo135(ans.Q16);
  const q19 = +ans.Q19;
  const I_Commit = (q11v + q12 + q13v + q16v + q19) / 5;

  return { I_Energy, I_Companion, I_Emotion, I_Life, I_Commit, w };
}

function judgeType(ans){
  const ix = calcIndexes(ans);

  // Early Exit: T1（任两条）
  const t1Signals = [
    ix.I_Energy <= 2.5,
    ans.Q4 === true,
    ans.Q2 === "A",
    (+ans.Q19) <= 2
  ].filter(Boolean).length;

  if (t1Signals >= 2){
    return {
      main: "T1",
      secondary: null,
      confidence: "高",
      indexes: ix,
      note: `T1 early-exit（命中 ${t1Signals} 条）`
    };
  }

  // 主轴功能排序
  const func = [
    ["I_Companion", ix.I_Companion],
    ["I_Emotion", ix.I_Emotion],
    ["I_Life", ix.I_Life],
  ].sort((a,b)=>b[1]-a[1]);

  const mainFunc = func[0][0];
  const mainFuncScore = func[0][1];
  const secondFunc = func[1][0];
  const secondFuncScore = func[1][1];

  // T6 判定（v2.0 组合判定）
  const condA = (ans.Q17 === "B") || (ans.Q18 === true);
  const condB = (ix.I_Commit <= 3) && ((+ans.Q19) <= 3);
  const condC = (mainFuncScore - secondFuncScore) <= 3;
  const allowT6 = condA && condB && condC;

  // T5 严格判定
  const isT5 =
    ix.I_Commit >= 4 &&
    ((ix.I_Emotion >= 15) || (ix.I_Life >= 15)) &&
    (ans.Q17 === "C");

  // 主型（先判 T5）
  let main = null;
  if (isT5){
    main = "T5";
  } else {
    if (mainFunc === "I_Companion" && ix.I_Commit < 3.5) main = "T2";
    else if (mainFunc === "I_Emotion" && ix.I_Commit >= 2.5 && ix.I_Commit < 4) main = "T3";
    else if (mainFunc === "I_Life" && ix.I_Commit >= 3) main = "T4";
    else {
      main = (mainFunc === "I_Companion") ? "T2" : (mainFunc === "I_Emotion") ? "T3" : "T4";
    }
  }

  // 次型（主次并行）
  let secondary = null;
  const secondClose = (mainFuncScore - secondFuncScore) <= 3;
  if (ix.I_Commit >= 3 && secondClose){
    secondary = (secondFunc === "I_Companion") ? "T2" : (secondFunc === "I_Emotion") ? "T3" : "T4";
    if (secondary === main) secondary = null;
  }

  // 置信度：主轴领先越多越高
  let confidence = "中";
  const lead = mainFuncScore - secondFuncScore;
  if (lead >= 6) confidence = "高";
  else if (lead <= 2) confidence = "低";

  let note = `主轴=${mainFunc}(${mainFuncScore.toFixed(1)}), 次轴=${secondFunc}(${secondFuncScore.toFixed(1)}), I_Commit=${ix.I_Commit.toFixed(2)}`;

  // T6 作为“状态标签”优先放次型（更温柔）
  if (allowT6){
    if (lead <= 2){
      secondary = "T6";
    } else {
      note += "｜T6条件成立（状态探索），未覆盖主型";
      if (ans.Q18 === true) secondary = "T6";
    }
  }

  return { main, secondary, confidence, indexes: ix, note };
}

/**
 * =========================
 * 4) 一题一页 UI
 * =========================
 */
const questionArea = document.getElementById("questionArea");
const stepText = document.getElementById("stepText");
const progressInner = document.getElementById("progressInner");
const warn = document.getElementById("warn");
const out = document.getElementById("out");
const miniHint = document.getElementById("miniHint");

let currentIndex = 0;

// 答案存储（跨页）
const answers = {}; // { Q1: ..., Q2: ... }

function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;")
    .replaceAll("\n","<br/>");
}

function totalRequired(){
  // 除 Q21 以外都必填
  return QUESTIONS.filter(q => q.id !== "Q21").length;
}

function countAnsweredRequired(){
  let n = 0;
  for (const q of QUESTIONS){
    if (q.id === "Q21") continue;
    if (answers[q.id] !== undefined && answers[q.id] !== null && answers[q.id] !== "") n++;
  }
  return n;
}

function renderProgress(){
  const total = QUESTIONS.length;
  const step = currentIndex + 1;
  stepText.textContent = `第 ${step} / ${total} 题`;

  // 进度条：用“必填完成度”更符合心理测验体验
  const done = countAnsweredRequired();
  const req = totalRequired();
  const pct = Math.round((done / req) * 100);
  progressInner.style.width = `${Math.min(100, Math.max(0, pct))}%`;

  miniHint.textContent = `已完成必填：${done}/${req}（${pct}%）`;
}

function renderQuestion(){
  warn.textContent = "";
  out.innerHTML = "";

  const q = QUESTIONS[currentIndex];

  // 按钮状态
  document.getElementById("btnPrev").disabled = currentIndex === 0;

  // Next按钮文本
  const isLast = currentIndex === QUESTIONS.length - 1;
  document.getElementById("btnNext").textContent = isLast ? "提交并查看结果" : "下一题";

  renderProgress();

  // 题卡
  const card = document.createElement("div");
  card.className = "qcard";

  const title = document.createElement("div");
  title.className = "qtitle";
  title.textContent = q.title;
  card.appendChild(title);

  const hint = document.createElement("div");
  hint.className = "qhint";
  if (q.id === "Q21") hint.textContent = "可不填，一句话就好。";
  else hint.textContent = "请选择最符合你当下状态的选项。";
  card.appendChild(hint);

  const opts = document.createElement("div");
  opts.className = "opts";

  // 渲染控件 + 回填
  if (q.type === "scale"){
    const sel = document.createElement("select");
    sel.name = q.id;

    const op0 = document.createElement("option");
    op0.value = "";
    op0.textContent = "请选择…";
    sel.appendChild(op0);

    for (let i=1;i<=5;i++){
      const op = document.createElement("option");
      op.value = String(i);
      op.textContent = q.labels ? q.labels[i-1] : String(i);
      sel.appendChild(op);
    }

    if (answers[q.id] !== undefined && answers[q.id] !== ""){
      sel.value = String(answers[q.id]);
    }

    sel.addEventListener("change", () => {
      answers[q.id] = sel.value ? Number(sel.value) : "";
      renderProgress();
    });

    opts.appendChild(sel);
  }

  if (q.type === "single"){
    q.options.forEach(([val, labelText])=>{
      const lab = document.createElement("label");
      lab.className = "opt";

      const r = document.createElement("input");
      r.type = "radio";
      r.name = q.id;
      r.value = val;

      if (answers[q.id] === val) r.checked = true;

      r.addEventListener("change", ()=>{
        answers[q.id] = val;
        renderProgress();
      });

      const sp = document.createElement("span");
      sp.textContent = `${val}. ${labelText}`;

      lab.appendChild(r);
      lab.appendChild(sp);
      opts.appendChild(lab);
    });
  }

  if (q.type === "bool"){
    [["yes","是"],["no","否"]].forEach(([val, text])=>{
      const lab = document.createElement("label");
      lab.className = "opt";

      const r = document.createElement("input");
      r.type = "radio";
      r.name = q.id;
      r.value = val;

      const stored = answers[q.id];
      if (stored === true && val === "yes") r.checked = true;
      if (stored === false && val === "no") r.checked = true;

      r.addEventListener("change", ()=>{
        answers[q.id] = (val === "yes");
        renderProgress();
      });

      const sp = document.createElement("span");
      sp.textContent = text;

      lab.appendChild(r);
      lab.appendChild(sp);
      opts.appendChild(lab);
    });
  }

  if (q.type === "text"){
    const ta = document.createElement("textarea");
    ta.name = q.id;
    ta.placeholder = "可不填。一句话就好。";
    if (answers[q.id] !== undefined) ta.value = answers[q.id];

    ta.addEventListener("input", ()=>{
      answers[q.id] = ta.value || "";
    });

    opts.appendChild(ta);
  }

  card.appendChild(opts);
  questionArea.innerHTML = "";
  questionArea.appendChild(card);
}

function validateCurrent(){
  const q = QUESTIONS[currentIndex];
  if (q.id === "Q21") return true; // optional
  const v = answers[q.id];
  if (v === undefined || v === null || v === "") return false;
  return true;
}

function goNext(){
  warn.textContent = "";

  if (!validateCurrent()){
    warn.textContent = "⚠️ 这一题还没选完哦。";
    return;
  }

  const isLast = currentIndex === QUESTIONS.length - 1;
  if (!isLast){
    currentIndex++;
    renderQuestion();
    return;
  }

  // 最后一题：计算结果
  try{
    // 将 answers 作为判型输入（确保未答题报错清晰）
    const res = judgeType(answers);
    renderResult(res, answers);
  }catch(e){
    warn.textContent = `⚠️ ${e.message || String(e)}`;
  }
}

function goPrev(){
  warn.textContent = "";
  if (currentIndex > 0){
    currentIndex--;
    renderQuestion();
  }
}

function renderResult(res, ans){
  const mainCopy = COPY[res.main];
  const secCopy = res.secondary ? COPY[res.secondary] : null;

  const ix = res.indexes;
  const html = `
    <div class="result">
      <div style="margin-bottom:10px;">
        <span class="pill">主类型：${res.main}</span>
        ${res.secondary ? `<span class="pill">次类型：${res.secondary}</span>` : `<span class="pill">次类型：无</span>`}
        <span class="pill">置信度：${res.confidence}</span>
      </div>

      <h2 style="margin:8px 0 6px; font-size:18px;">${mainCopy.title}</h2>
      <div><b>${mainCopy.one}</b></div>
      <div style="margin-top:8px;">${mainCopy.body}</div>
      <div style="margin-top:10px;"><i>温柔提醒：</i>${mainCopy.tip}</div>

      ${secCopy ? `
        <hr style="margin:16px 0;" />
        <h3 style="margin:0 0 6px; font-size:16px;">次类型补充：${secCopy.title}</h3>
        <div><b>${secCopy.one}</b></div>
        <div style="margin-top:8px;">${secCopy.body}</div>
      ` : ""}

      <hr style="margin:16px 0;" />
      <div style="font-weight:800; margin-bottom:6px;">指标（Debug）</div>
      <div class="mono">
I_Energy=${ix.I_Energy.toFixed(2)}
I_Companion=${ix.I_Companion.toFixed(1)} (w=${ix.w})
I_Emotion=${ix.I_Emotion.toFixed(1)} (w=${ix.w})
I_Life=${ix.I_Life.toFixed(1)} (w=${ix.w})
I_Commit=${ix.I_Commit.toFixed(2)}
note=${res.note}
      </div>

      ${ans.Q21 ? `<div style="margin-top:12px;"><b>你的开放回答：</b><br/>${escapeHtml(ans.Q21)}</div>` : ""}

      <div class="mini" style="margin-top:10px;">
        ✅ 你可以点击「清空重来」再次测试，或把这个页面直接静态部署给用户使用。
      </div>
    </div>
  `;
  out.innerHTML = html;

  // 结果出来后把焦点滚到结果
  setTimeout(()=>window.scrollTo({ top: document.body.scrollHeight, behavior:"smooth" }), 50);
}

function resetAll(){
  for (const k of Object.keys(answers)) delete answers[k];
  currentIndex = 0;
  renderQuestion();
  out.innerHTML = "";
  warn.textContent = "";
}

document.getElementById("btnNext").addEventListener("click", goNext);
document.getElementById("btnPrev").addEventListener("click", goPrev);

document.getElementById("btnReset").addEventListener("click", resetAll);

// 仅内测用：快速跳到最后一题
document.getElementById("btnJumpToResult").addEventListener("click", ()=>{
  currentIndex = QUESTIONS.length - 1;
  renderQuestion();
});

renderQuestion();
</script>
</body>
</html>
